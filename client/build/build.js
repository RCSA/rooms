function require(e,t,n){var r=require.resolve(e);if(null==r){n=n||e,t=t||"root";var i=Error('Failed to require "'+n+'" from "'+t+'"');throw i.path=n,i.parent=t,i.require=!0,i}var o=require.modules[r];return o.exports||(o.exports={},o.client=o.component=!0,o.call(this,o.exports,require.relative(r),o)),o.exports}var has=Object.prototype.hasOwnProperty;require.modules={},require.aliases={},require.resolve=function(e){"/"===e.charAt(0)&&(e=e.slice(1));for(var t=e+"/index.js",n=[e,e+".js",e+".json",e+"/index.js",e+"/index.json"],r=0;n.length>r;r++){var e=n[r];if(has.call(require.modules,e))return e}return has.call(require.aliases,t)?require.aliases[t]:void 0},require.normalize=function(e,t){var n=[];if("."!=t.charAt(0))return t;e=e.split("/"),t=t.split("/");for(var r=0;t.length>r;++r)".."==t[r]?e.pop():"."!=t[r]&&""!=t[r]&&n.push(t[r]);return e.concat(n).join("/")},require.register=function(e,t){require.modules[e]=t},require.alias=function(e,t){if(!has.call(require.modules,e))throw Error('Failed to alias "'+e+'", it does not exist');require.aliases[t]=e},require.relative=function(e){function t(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(t){var r=n.resolve(t);return require(r,e,t)}var r=require.normalize(e,"..");return n.resolve=function(n){var i=n.charAt(0);if("/"==i)return n.slice(1);if("."==i)return require.normalize(r,n);var o=e.split("/"),a=t(o,"deps")+1;return a||(a=0),n=o.slice(0,a+1).join("/")+"/deps/"+n},n.exists=function(e){return has.call(require.modules,n.resolve(e))},n},require.register("ForbesLindesay-curry/index.js",function(e,t,n){function r(e){return Array.prototype.slice.apply(e)}function i(e){function t(){if(arguments.length<e.length){var n=r(arguments);return function(){return t.apply(this,n.concat(r(arguments)))}}return e.apply(this,arguments)}return t}n.exports=i}),require.register("ForbesLindesay-queue/index.js",function(e,t,n){function r(e){function t(){if(0===r.length)for(var e=n.length,t=0;e>t;t++)r.push(n.pop());return i}var n=[],r=[],i=e||{};return i.enqueue=function(e){n.push(e)},i.dequeue=function(){if(t(),!r.length)throw Error("Can't dequeue from an empty queue");return r.pop()},i.peek=function(){if(t(),!r.length)throw Error("Can't peek from an empty queue");return r[r.length-1]},i.isEmpty=function(){return 0===n.length&&0===r.length},i}n.exports=r,r(n.exports)}),require.register("component-to-function/index.js",function(e,t,n){function r(e){switch({}.toString.call(e)){case"[object Function]":return e;case"[object String]":return a(e);case"[object RegExp]":return o(e);default:return i(e)}}function i(e){return function(t){return e===t}}function o(e){return function(t){return e.test(t)}}function a(e){return/^ *\W+/.test(e)?Function("_","return _ "+e):Function("_","return _."+e)}n.exports=r}),require.register("component-type/index.js",function(e,t,n){var r=Object.prototype.toString;n.exports=function(e){switch(r.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}}),require.register("ForbesLindesay-to-bool-function/index.js",function(e,t,n){function r(e,t){if(2==arguments.length)return e=a(e),t=r(t),function(){return t(e.apply(this,arguments))};t=e;var n=!1;try{switch(s(t)){case"regexp":n=i(t);break;case"string":case"function":n=a(t);break;case"object":n=o(t)}}catch(l){}return function(e){return e===t||n&&n.apply(this,arguments)}}function i(e){return function(t){return e.test(t)}}function o(e){var t=Object.keys(e).map(function(t){return r(t,e[t])});return function(e){for(var n=0;t.length>n;n++)if(!t[n](e))return!1;return!0}}var a=t("to-function"),s=t("type");n.exports=r}),require.register("ForbesLindesay-utf8-encode/index.js",function(e,t,n){function r(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(192|r>>6),t+=String.fromCharCode(128|63&r)):(t+=String.fromCharCode(224|r>>12),t+=String.fromCharCode(128|63&r>>6),t+=String.fromCharCode(128|63&r))}return t}n.exports=r}),require.register("ForbesLindesay-base64-encode/index.js",function(e,t,n){function r(e){var t,n,r,a,s,l,c,u="",d=0;for(e=i(e);e.length>d;)t=e.charCodeAt(d++),n=e.charCodeAt(d++),r=e.charCodeAt(d++),a=t>>2,s=(3&t)<<4|n>>4,l=(15&n)<<2|r>>6,c=63&r,isNaN(n)?l=c=64:isNaN(r)&&(c=64),u=u+o.charAt(a)+o.charAt(s)+o.charAt(l)+o.charAt(c);return u}var i=t("utf8-encode"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.exports=r}),require.register("ForbesLindesay-promises-a/index.js",function(e,t,n){(function(){function e(){function t(e){d.length?(p=!0,d.shift()(e||!1)):p=!1}function n(n,r){function i(e){function i(){var e;try{e=a(l)}catch(n){return o.reject(n),t()}o.fulfill(e),t(!0)}var a=u?n:r;"function"==typeof a?e?i():setTimeout(i,0):u?(o.fulfill(l),t(e)):(o.reject(l),t(e))}var o=e();return d.push(i),c&&!p&&t(),o.promise}function r(e,t){var n=f;(e||t)&&(n=n.then(e,t)),n.then(null,function(e){setTimeout(function(){throw e},0)})}function i(e,n){if(!c){if(e&&"object"==typeof n&&"function"==typeof n.then)return n.then(o,a),void 0;c=!0,u=e,l=n,t()}}function o(e){i(!0,e)}function a(e){i(!1,e)}function s(){return u?l:f}var l,c=!1,u=!1,d=[],p=!1,f={then:n,valueOf:s,done:r};return{promise:f,fulfill:o,reject:a}}n!==void 0&&n.exports!==void 0?n.exports=e:window.promise=e})()}),require.register("ForbesLindesay-imgur/index.js",function(e,t,n){function r(e){function t(t){var n=i();o(n.promise);try{if(!t){var r=Error("You must supply an image to upload.");throw r.code="MissingFile",r}if(!t.type.match(/image.*/)){var r=Error("Invalid file type, imgur only accepts images.");throw r.code="InvalidFileType",r}var a=new FormData;a.append("image",t),a.append("key",e);var s=new XMLHttpRequest;s.open("POST","http://api.imgur.com/2/upload.json"),s.onload=function(){try{n.fulfill(JSON.parse(s.responseText).upload)}catch(e){n.reject(e)}},s.onerror=n.reject,s.upload.onprogress=function(e){e.perecent=100*(e.loaded/e.total),n.promise.emit("progress",e)},n.promise.abort=function(){s.abort();var e=Error("Image upload aborted");e.code="UploadAborted",n.reject(e)},s.send(a)}catch(l){n.reject(l)}return n.promise}return{upload:t}}var i=t("promises-a"),o=t("emitter");n.exports=r}),require.register("component-find/index.js",function(e,t,n){function r(e){return function(t){for(var n in e)if(t[n]!=e[n])return!1;return!0}}var i=t("to-function");n.exports=function(e,t){"function"!=typeof t&&(t=Object(t)===t?r(t):i(t));for(var n=0,o=e.length;o>n;++n)if(t(e[n],n))return e[n]}}),require.register("component-group-by/index.js",function(e,t,n){var r=t("to-function");n.exports=function(e,t){var n,i={};t=r(t);for(var o=0;e.length>o;++o)n=t(e[o],o),i[n]=i[n]||[],i[n].push(e[o]);return i}}),require.register("component-emitter/index.js",function(e,t,n){function r(e){return e?i(e):void 0}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}n.exports=r,r.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},t._off=n,this.on(e,n),this},r.prototype.off=function(e,t){this._callbacks=this._callbacks||{};var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;var r=n.indexOf(t._off||t);return~r&&n.splice(r,1),this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),require.register("rooms/index.js",function(e,t){function n(){function t(t,r){var i=r.exit||function(){};g.map(t).to(function(){var t=p(e.Navigation,b("id",this.params[r.id]||r.id))||r.item,i=this.params[r.parentIDs]||r.parentIDs;(!i||t.parentid===i||r.parentIDs.some&&r.parentIDs.some(function(e){return e==t.parentid}))&&n(t,r.edit,r.enter)}).exit(i)}function n(t,n,a){if(!t)return!1;if(e.checkAuth(t)!==!1)if("Root"===t.parentid?e.reloadNavigation(t.id):e.reloadNavigation(t.parentid,t.id),n)c(t);else switch(t.type){case"staircase":return i(t);case"page":return r(t);case"room":return o(t);case"special":return a(t);default:return!1}}g.map("#/projector/").to(a.enter).exit(a.exit),t("#/allocationEdit/",{id:"allocationEdit",enter:s.enter,exit:s.exit}),t("#/navigationTableEdit/",{id:"navigationTableEdit",enter:l,item:{id:"navigationTableEdit",type:"special"}}),t("#//edit/",{id:"",parentIDs:"",edit:!0}),t("#/:id/edit/",{id:"id",edit:!0}),t("#/",{id:"",parentIDs:""}),t("#/:sid/",{id:"sid",parentIDs:["","Root"]}),t("#/:sid/:rid/",{id:"rid",parentIDs:"sid"})}var r=t("./views/static-page"),i=t("./views/staircase"),o=t("./views/room"),a=t("./views/projector"),s=t("./views/allocation-edit"),l=t("./views/navigation-table-edit"),c=t("./markdown/edit-markdown"),u=t("./model"),d=t("./helpers/navigation-item-order"),p=t("find"),f=t("./helpers/status-display").uri,h=t("./template"),g=t("./libraries/path"),m=t("./server"),v=t("./stream"),b=t("to-bool-function"),y=jQuery;e.SelectedStaircaseID="",e.SelectedRoomID="",e.Navigation=[],e.authorization=!1,y(function(){function t(){return r&&n(r),e}function n(e){r=e,y(".allocationDisplay").each(function(){var t=y(this),n={};n="current"===t.attr("data-year")?e.allocationsThisYear:"next"===t.attr("data-year")?e.allocationsNextYear:e.defaultAllocations(),t.html(n[t.attr("data-roomid")]||n.defaultText)})}var r=!1;v.on("allocations",n),e.refreshAllocationsDisplay=t}),y(function(){function t(t){return r=t,e.authorization&&n(e.authorization,!0),e}function n(t,n){if(e.authorization=t,n!==!0&&e.reloadNavigation(),t.isAuthenticated?y("#login").hide():y("#login").show(),r&&(t.markdownEdit&&(r.isRoom&&r.isRoom()||r.isStaircase&&r.isStaircase()||e.authorization.markdownSpecialEdit)?y("#editLink").show():y("#editLink").hide(),t.isAuthenticated===!1&&("#/projector/"===location.hash||"#/navigationTableEdit/"===location.hash||"#/allocationEdit/"===location.hash||/\/edit\/$/.test(location.hash)))){var i=f();return location.hash="#/",window.location.href=i,void 0}}var r;v.on("auth",n),e.checkAuth=t}),e.reloadNavigation=function(t,n){function r(t){return"navigationTableEdit"===t.id?e.authorization&&e.authorization.navigationEdit:"allocationEdit"===t.id?e.authorization&&e.authorization.allocationsEdit:!0}arguments.length>0&&(e.SelectedStaircaseID=t,e.SelectedRoomID=n);var i=e.Navigation.filter(r),o=i.filter(b("parentid","Root"));y("#staircases").html(h("NavigationList",{Links:o}));var a=i.filter(b("parentid",e.SelectedStaircaseID));y("#rooms").html(h("NavigationList",{Links:a}))},g.root("#/"),n(),m.navigation.read(function(t){e.Navigation=t.map(u.navigationItem).sort(d),y(function(){y("body").removeClass("loading").addClass("background"),y("#page").fadeIn(),g.listen(),y("#isThisYears").click(e.refreshAllocationsDisplay)})})}),require.register("rooms/model.js",function(e,t,n){function r(e){return function(){return this.type===e}}function i(){var e="#/";return""!==this.parentid&&"Root"!==this.parentid&&(e+=this.parentid+"/"),""!==this.id&&(e+=this.id+"/"),e}function o(){return"Root"===this.parentid&&u.SelectedStaircaseID===this.id||this.parentid===u.SelectedStaircaseID&&u.SelectedRoomID===this.id}function a(){switch(this.bathroomsharing){case 0:return"";case 1:return"Ensuite";default:return"Shared between "+this.bathroomsharing+" people"}}function s(){return 1===this.isgardenfacing?"Garden Facing":0===this.isgardenfacing?"Courtyard Facing":"unknown"}function l(){return u.allocationsNextYear[this.id]||""}function c(){return this.name.replace(/<br\/>/g," ")}var u=t("./"),d=function(){var e=["Ground Floor","First Floor","Second Floor","Third Floor","Fourth Floor","Fith Floor","Sixth Floor"];return e[-1]="Basement",function(){return e[this.floor]||"Floor "+this.floor}}(),p=function(){var e=["Unavailable to Students","Value","Standard","Standard Plus","Best"];return function(){return e[this.rentband]||this.rentband}}();isStaircase=r("staircase"),isRoom=r("room"),isPage=r("page"),isSpecial=r("special"),n.exports.navigationItem=function(e){var t=Object.create(e);return t.weight=e.weight||0,t.isStaircase=isStaircase,t.isRoom=isRoom,t.isPage=isPage,t.isSpecial=isSpecial,t.url=i,t.selected=o,t.bathroom=a,t.floorDescription=d,t.gardenFacing=s,t.allocation=l,t.nameSingleLine=c,t.rentBandDescription=p,t}}),require.register("rooms/views/static-page.js",function(e,t,n){function r(e){i(e,!0),document.getElementById("templated").innerHTML=""}var i=t("../markdown/load-markdown");n.exports=r}),require.register("rooms/views/staircase.js",function(e,t,n){function r(e){return Object.keys(e).map(function(t){return{floor:t,Name:e[t][0].floorDescription(),Rooms:e[t]}}).sort(function(e,t){return e.floor-t.floor})}var i=t("../"),o=t("../markdown/load-markdown"),a=t("../template"),s=t("group-by"),l=t("to-bool-function");n.exports=function(e){o(e);var t=i.Navigation.filter(l("parentid",e.id)).filter(l("type","room")),n=r(s(t,"floor"));document.getElementById("templated").innerHTML=a("staircase",{Floors:n}),i.refreshAllocationsDisplay()}}),require.register("rooms/views/room.js",function(e,t,n){var r=t("../"),i=t("../markdown/load-markdown"),o=t("../template");n.exports=function(e){i(e),$("#templated").html(o("room",e)),r.refreshAllocationsDisplay()}}),require.register("rooms/views/projector.js",function(e,t){function n(e){return Object.keys(e).map(function(t){var n=Object.create(o(i.Navigation,d("id",t)));return n.rooms=e[t].filter(function(e){return 0!==e.rentband}),n})}var r,i=t("../"),o=t("find"),a=t("../helpers/status-display").uri,s=t("../template"),l=t("../helpers/navigation-item-order"),c=t("group-by"),u=t("../stream"),d=t("to-bool-function"),p=!1;$("#isThisYears").click(function(){p&&(e.exit(),e.enter())});var f,h=!0;e.enter=function(){function e(e){var t=e.roomid;""===e.crsid?($("#"+t).addClass("available").removeClass("unavailable").fadeIn(),h||$(".allocationDisplayPart").hide()):($("#"+t).removeClass("available").addClass("unavailable").find(".allocationDisplayPart").show(),h||$("#"+t).fadeOut(5e3))}if(i.checkAuth({id:"projector"}),p=!0,i.authorization.updated&&!i.authorization.isAuthenticated&&!i.authorization.allocationsView){var t=a();return location.hash="#/",window.location.href=t,void 0}r=$("#colmask").html(),$("#header").html('<input type="checkbox" '+(h?"":"checked")+">Hide Unavailable Rooms").find("input").click(function(){h=0===$("#header :checkbox:checked").length,h?($(".allocationDisplayPart").fadeIn(5e3),$(".unavailable:not(.permanentlyUnavailable)").fadeIn(5e3)):($(".allocationDisplayPart").fadeOut(2e3),$(".unavailable").fadeOut(2e3))});var o=n(c(i.Navigation.filter(d("type","room")),"parentid")).sort(l);$("#page").removeClass("page").addClass("projector"),$("body").removeClass("background"),$("#colmask").html(s("projector",{staircases:o})),$("footer").hide(),i.refreshAllocationsDisplay(),f=u.onAllocationChanged(e),h||($(".allocationDisplayPart").hide(),$(".unavailable").hide())},e.exit=function(){p=!1,f(),$("#page").addClass("page").removeClass("projector"),$("body").addClass("background"),$("#colmask").html(r),$("footer").show(),$("#header").html("")}}),require.register("rooms/views/navigation-table-edit.js",function(e,t,n){function r(e){return!isNaN(Number(e))&&Number(e)>=0}function i(e){return!isNaN(Number(e))&&Number(e)>-5&&20>Number(e)}function o(e){return!isNaN(Number(e))&&0!==Number(e)}function a(e){return alert(e),!1}function s(e,t){if(t&&p.Navigation.some(w("id",e.id)))return a("There is already an item with this ID");if(e.id===e.parentid)return a("An item can't be its own parent");if("Root"!==e.parentid&&!p.Navigation.some(w("id",e.parentid)))return a('The parent ID must either be the ID of an existing item or "Root"');if("room"===e.type){if(!r(e.bathroomsharing))return a("A room must have a number greater than 0 to specify how many people the bathroom is shared with.");if(!i(e.floor))return a("A room must have a sensible floor number.")}else{if(void 0!==e.bathroomsharing)return a("Only a room can have a value for Bathroom Sharing.");if(void 0!==e.rentband)return a("Only a room can have a value for Rent Band.");if(void 0!==e.floor)return a("Only a room can have a value for Floor.");if(void 0!==e.isgardenfacing)return a("Only a room can have a value for Garde Facing.")}return!0}function l(e,t){for(var n=p.Navigation.filter(w("parentid",e)),r=0;n.length>r;r++)n[r].parentid=t}function c(e){var t=e.target,n={id:t.id.value,name:t.name.value,parentid:t.parentid.value,type:t.type.value};return o(t.weight.value)&&(n.weight=t.weight.value),"room"===n.type&&(n.bathroomsharing=t.bathroomsharing.value,n.rentband=t.rentband.value,n.floor=t.floor.value),s(n,!0)&&(p.Navigation.push(f.navigationItem(n)),p.Navigation=p.Navigation.sort(b),m("Saving..."),y.navigation.create(n,function(){m("Saved",2e3)}),view.navigationTableEdit(f.navigationItem(n))),!1}function u(e,t,n){var r=p.Navigation.filter(w("id",e))[0],i=Object.create(r);return i[t]=n,s(i,"id"===t)?(r[t]=n,"id"===t&&l(e,n),m("Saving..."),y.navigation.update(e,t,n,function(){m("Saved",2e3)}),void 0):!1}var d,p=t("../"),f=t("../model"),h=t("../markdown/load-markdown"),g=t("../helpers/table"),m=t("../helpers/status-display").setStatus,v=t("../template"),b=t("../helpers/navigation-item-order"),y=t("../server"),w=t("to-bool-function");n.exports=function(e){if("navigationTableEdit"===e.id)d=e;else{var t=e;e=d}h(e,!0);var n=t?Object.create(t):{};n.Navigation=p.Navigation,$("#templated").html(v("navigationTableEdit",n)).find("form").submit(c),g("#templated",u),$("#templated button").click(function(e){if(confirm("Are you sure you want to delete?")){var t=$(e.target).parents("tr").attr("itemid"),n=p.Navigation.indexOf(p.Navigation.filter(w("id",t))[0]);p.Navigation.splice(n,1),view.navigationTableEdit(),m("Deleting..."),y.navigation.del(t,function(){m("Deleted",2e3)})}}),p.reloadNavigation("","navigationTableEdit")}}),require.register("rooms/views/allocation-edit.js",function(e,t){function n(e,t){return Object.keys(t).map(function(n){var r=Object.create(l(o.Navigation,g("id",n)));return r.rooms=t[n].map(m(e)),r})}function r(e){v=!0,e&&d(e,!0),$("#templated").html(),h.getAllocations(function(e){var t=e.defaultAllocations(),r=t.year,i=n(t,p(o.Navigation.filter(g("type","room")).filter(function(e){return 0!==e.rentband}),"parentid")).sort(u);$("#templated").html(c("allocationEdit",{staircases:i,year:r})).find("form").submit(function(e){var t=e.currentTarget.allocation.value,n=$(e.currentTarget);return n.find("input").removeClass("validationError"),n.attr("data-old-allocation")!==t&&(n.attr("data-old-allocation",t),a("Updating Allocation"),f.allocation.update(n.attr("data-roomid"),r,t,function(e){a(e,5e3)})),!1}).find("input").blur(function(e){$(e.target).submit()})}),h.onAllocationChanged(function(e){var t=e.roomid;$('form[data-roomid="'+t+'"] input').val(e.crsid)})}function i(){v=!1}var o=t("../"),a=t("../helpers/status-display").setStatus,s=t("curry"),l=t("find"),c=t("../template"),u=t("../helpers/navigation-item-order"),d=t("../markdown/load-markdown"),p=t("group-by"),f=t("../server"),h=t("../stream"),g=t("to-bool-function"),m=s(function(e,t){var n=e[t.id];return{id:t.id,name:t.nameSingleLine(),allocation:n||""}}),v=!1;$("#isThisYears").click(function(){v&&r()}),e.enter=r,e.exit=i}),require.register("rooms/markdown/load-markdown.js",function(e,t,n){var r=t("../"),i=t("./converter"),o=t("../server");n.exports=function(e){o.markdown.read(e,function(t){$("#markdown").html(Mustache.to_html('{{{Content}}}<a id="editLink" href="#/{{ID}}/edit/">edit</a>',{ID:e.id,Content:i.makeHtml(t)})),r.refreshAllocationsDisplay(),r.checkAuth(e)})}}),require.register("rooms/markdown/edit-markdown.js",function(e,t,n){function r(){function e(){$("#busy").dialog({autoOpen:!0,closeOnEscape:!1,draggable:!1,resizable:!1,modal:!0,height:80,width:180})}function t(){$("#busy").dialog("close")}function n(e,t){$("#"+e).dialog({autoOpen:!0,closeOnEscape:!0,minWidth:500,modal:!0,buttons:{OK:function(){$(this).dialog("close"),t($(this))},Cancel:function(){$(this).dialog("close"),t(null)}},close:function(){$(this).hide(),t(!1)}})}return $(".dialog").dialog({autoOpen:!1}),{showBusy:e,hideBusy:t,showDialog:n}}function i(){var e=new l.Editor(a),t=r();e.hooks.chain("onPreviewRefresh",function(){o.refreshAllocationsDisplay()}),e.hooks.set("insertImageDialog",function(e){return t.showDialog("getImage",function(n){n===!1?e(null):(t.showBusy(),f(n.find("input")[0].files[0]).done(function(n){t.hideBusy(),e(n.links.original)},function(n){if(t.hideBusy(),e(null),"InvalidFileType"===n.code)alert("The file you provided was not a valid image.");else{if("MissingFile"!==n.code)throw n;alert("You didn't provide an image to upload")}}))}),!0}),e.run()}var o=t("../"),a=t("./converter"),s=t("../helpers/status-display").setStatus,l=t("../libraries/pagedown.js"),c=t("../template"),u=t("../server"),d=t("imgur"),p="e0b484465d77858ebaf6b3c7c1732909",f=d(p).upload;n.exports=function(e){u.markdown.read(e,function(t){$("#markdown").html(c("markdownEdit",{Content:t})).find("form").submit(function(n){var r=n.target,i=r.content.value;return i!==t?(s("Saving description"),u.markdown.update(e.id,i,function(){history.go(-1),s("Description saved",2e3)}),!1):(s("Description not changed",2e3),history.go(-1),!1)}),i()})}}),require.register("rooms/markdown/converter.js",function(e,t,n){var r=t("../libraries/pagedown.js"),i=n.exports=r.getSanitizingConverter();i.hooks.chain("preConversion",function(e){return e.replace(/\(#(.*)\)/g,"(http://hashurl.com/$1)").replace(/]: #(.*)/g,"]: http://hashurl.com/$1")}),i.hooks.chain("postConversion",function(e){return e.replace(/http:\/\/hashurl.com\//g,"#")}),i.hooks.chain("preConversion",function(e){return e.replace(/((\r\n|\n|\r)\/\/.*$)|(^\/\/.*(\r\n|\n|\r))/gm,"")}),i.hooks.chain("postConversion",function(e){return e.replace(/\[allocation:([^\]]*)\]/g,'<span class="allocationDisplay" data-roomid="$1"></span>').replace(/\[allocation-current:([^\]]*)\]/g,'<span class="allocationDisplay" data-roomid="$1" data-year="current"></span>').replace(/\[allocation-next:([^\]]*)\]/g,'<span class="allocationDisplay" data-roomid="$1" data-year="next"></span>')}),i.hooks.chain("postConversion",function(e){return e.replace(/\/>\[(left|right|middle|top|bottom)\]/g,'align="$1" />')}),i.hooks.chain("postConversion",function(e){return e.replace(/<\/h1>/g,"</h1><hr>")})}),require.register("rooms/helpers/table.js",function(e,t,n){function r(e,t){i(e).find("td").each(function(){var e=i(this),n=e.find("input,select");0!==n.length&&(e.dblclick(function(){var t=e.find("div");t.hide(),n.show().focus()}),n.blur(function(){var r=e.find("div"),i=e.attr("itemprop"),o=e.parents("tr").attr("itemid"),a="number"===n.attr("type")?Number(n.hide().val()):n.hide().val(),s=r.html();s!==a?t(o,i,a)===!1?(n.val(s),r.show()):r.show().html(a):r.show()}))})}var i=jQuery;n.exports=r}),require.register("rooms/helpers/navigation-item-order.js",function(e,t,n){function r(e,t){return e>t?1:t>e?-1:0}function i(e,t){return+e-+t}function o(e,t){return function(e,t){return"Root"===e&&"Root"!==t?-1:"Root"!==e&&"Root"===t?1:r(e,t)}(e.parentid,t.parentid)}function a(e,t){return i(e.weight,t.weight)}function s(e,t){return void 0!==e.floor&&void 0!==t.floor?i(e.floor,t.floor):void 0}function l(e,t){var n=e.id.match(u),o=t.id.match(u);return n&&o&&n.length>0&&o.length>0?i(parseInt(n[0],10),parseInt(o[0],10))||i(e.id.length,t.id.length)||r(e.id,t.id):r(e.id,t.id)}function c(){var e=arguments;return function(t,n){for(var r=0;e.length>r;r++){var i=e[r](t,n);if(i)return i}}}var u=/[0-9]+/g;n.exports=c(o,a,s,l)}),require.register("rooms/helpers/status-display.js",function(e,t){function n(e){void 0!==e.isAuthenticated&&(d=e.isAuthenticated),l=new Date,c||s()}function r(e){var t=""+e,n="00";return n.substr(t.length)+t}function i(){return r(l.getHours())+":"+r(l.getMinutes())+":"+r(l.getSeconds())}function o(){return"/raven/login/"+encodeURIComponent(location.hash)}function a(e,t){return c=!0,$("#status").html(e),void 0!==t&&setTimeout(this.clearStatus,t),this}function s(){return c=!1,d?$("#status").html("last updated "+i()):$("#status").html('<a  class="login" href="'+o()+'">Log in to view allocations and edit data</a>'),this}t("base64-encode");var l,c,u=t("../stream"),d=void 0;e.uri=o,e.setStatus=a,e.clearStatus=s,s(),u.on("auth",n),u.on("raw",n),$("#status").hover(function(){d||$("#status a").attr("href",o())}),$("#login").hover(function(){d||$("#loginButton").attr("href",o())})}),require.register("rooms/libraries/pagedown.js",function(e,t,n){var r={};(function(){function e(e){return e}function t(){return!1}function n(){}function i(){}n.prototype={chain:function(t,n){var r=this[t];if(!r)throw Error("unknown hook "+t);this[t]=r===e?n:function(e){return n(r(e))}},set:function(e,t){if(!this[e])throw Error("unknown hook "+e);this[e]=t},addNoop:function(t){this[t]=e},addFalse:function(e){this[e]=t}},r.HookCollection=n,i.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},r.Converter=function(){function e(e){return e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,t,n,r,i,o){return t=t.toLowerCase(),I.set(t,T(n)),i?r:(o&&A.set(t,o.replace(/"/g,"&quot;")),"")})}function t(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,r),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,r),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,r),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,r),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,r)}function r(e,t){var n=t;return n=n.replace(/^\n+/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(R.push(n)-1)+"K\n\n"}function o(e,n){e=f(e);var r="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),e=h(e),e=m(e),e=x(e),e=t(e),e=k(e,n)}function a(e){return e=b(e),e=s(e),e=$(e),e=u(e),e=l(e),e=C(e),e=e.replace(/~P/g,"://"),e=T(e),e=w(e),e=e.replace(/  +\n/g," <br>\n")}function s(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=L(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function l(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,c)}function c(e,t,n,r,i,o,a,s){void 0==s&&(s="");var l=t,c=n.replace(/:\/\//g,"~P"),u=r.toLowerCase(),p=i,f=s;if(""==p)if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+u,void 0!=I.get(u))p=I.get(u),void 0!=A.get(u)&&(f=A.get(u));else{if(!(l.search(/\(\s*\)$/m)>-1))return l;p=""}p=q(p),p=L(p,"*_");var h='<a href="'+p+'"';return""!=f&&(f=d(f),f=L(f,"*_"),h+=' title="'+f+'"'),h+=">"+c+"</a>"}function u(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p)}function d(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function p(e,t,n,r,i,o,a,s){var l=t,c=n,u=r.toLowerCase(),p=i,f=s;if(f||(f=""),""==p){if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+u,void 0==I.get(u))return l;p=I.get(u),void 0!=A.get(u)&&(f=A.get(u))}c=L(d(c),"*_[]()"),p=L(p,"*_");var h='<img src="'+p+'" alt="'+c+'"';return f=d(f),f=L(f,"*_"),h+=' title="'+f+'"',h+=" />"}function f(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+a(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+a(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return"<h"+r+">"+a(n)+"</h"+r+">\n\n"})}function h(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return _?e=e.replace(t,function(e,t,n){var r=t,i=n.search(/[*+-]/g)>-1?"ul":"ol",o=g(r,i);return o=o.replace(/\s+$/,""),o="<"+i+">"+o+"</"+i+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,r){var i=t,o=n,a=r.search(/[*+-]/g)>-1?"ul":"ol",s=g(o,a);return s=i+"<"+a+">\n"+s+"</"+a+">\n"})),e=e.replace(/~0/,"")}function g(e,t){_++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var n=F[t],r=RegExp("(^[ \\t]*)(?:"+n+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+n+")[ \\t]+))","gm"),i=!1;return e=e.replace(r,function(e,t,n){var r=/\n\n$/.test(n),s=r||n.search(/\n{2,}/)>-1;return s||i?n=o(E(n),!0):(n=h(E(n)),n=n.replace(/\n$/,""),n=a(n)),i=r,"<li>"+n+"</li>\n"}),e=e.replace(/~0/g,""),_--,e}function m(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,i=n;return r=y(E(r)),r=j(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>","\n\n"+r+"\n\n"+i}),e=e.replace(/~0/,"")}function v(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(R.push(e)-1)+"K\n\n"}function b(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r){return r=r.replace(/^([ \t]*)/g,""),r=r.replace(/[ \t]*$/g,""),r=y(r),r=r.replace(/:\/\//g,"~P"),t+"<code>"+r+"</code>"})}function y(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=L(e,"*_{}[]\\",!1)}function w(e){return e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}function x(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=o(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),v("<blockquote>\n"+n+"\n</blockquote>")})}function k(e,t){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var n=e.split(/\n{2,}/g),r=[],i=/~K(\d+)K/,o=n.length,s=0;o>s;s++){var l=n[s];i.test(l)?r.push(l):/\S/.test(l)&&(l=a(l),l=l.replace(/^([ \t]*)/g,"<p>"),l+="</p>",r.push(l))}if(!t){o=r.length;for(var s=0;o>s;s++)for(var c=!0;c;)c=!1,r[s]=r[s].replace(/~K(\d+)K/g,function(e,t){return c=!0,R[t]})}return r.join("\n\n")}function T(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function $(e){return e=e.replace(/\\(\\)/g,D),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,D)}function C(e){e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var t=function(e,t){return'<a href="'+t+'">'+N.plainLinkText(t)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,t)}function S(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function E(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function j(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],r=0;return e.replace(/[\n\t]/g,function(e,i){return"\n"===e?(r=i+1,e):(t=(i-r)%4,r=i+1,n[t])})}function q(e){if(!e)return"";var t=e.length;return e.replace(B,function(n,r){return"~D"==n?"%24":":"!=n||r!=t-1&&!/[0-9\/]/.test(e.charAt(r+1))?"%"+n.charCodeAt(0).toString(16):":"
})}function L(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=RegExp(r,"g");return e=e.replace(i,D)}function D(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var N=this.hooks=new n;N.addNoop("plainLinkText"),N.addNoop("preConversion"),N.addNoop("postConversion");var I,A,R,_;this.makeHtml=function(n){if(I)throw Error("Recursive call to converter.makeHtml");return I=new i,A=new i,R=[],_=0,n=N.preConversion(n),n=n.replace(/~/g,"~T"),n=n.replace(/\$/g,"~D"),n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),n="\n\n"+n+"\n\n",n=j(n),n=n.replace(/^[ \t]+$/gm,""),n=t(n),n=e(n),n=o(n),n=S(n),n=n.replace(/~D/g,"$$"),n=n.replace(/~T/g,"~"),n=N.postConversion(n),R=A=I=null,n};var F={ol:"\\d+[.]",ul:"[*+-]"},B=/(?:["'*()[\]:]|~D)/g}})(),function(){function e(e){return e.replace(/<[^><]*>?/gi,t)}function t(e){return e.match(i)||e.match(o)||e.match(a)?e:e.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")}function n(e){if(""==e)return"";var t=/<\/?\w+[^>]*(\s|$|>)/g,n=e.toLowerCase().match(t),r=(n||[]).length;if(0==r)return e;for(var i,o,a,s="<p><img><br><li><hr>",l=[],c=[],u=!1,d=0;r>d;d++)if(i=n[d].replace(/<\/?(\w+).*/,"$1"),!(l[d]||s.search("<"+i+">")>-1)){if(o=n[d],a=-1,!/^<\//.test(o))for(var p=d+1;r>p;p++)if(!l[p]&&n[p]=="</"+i+">"){a=p;break}-1==a?u=c[d]=!0:l[a]=!0}if(!u)return e;var d=0;return e=e.replace(t,function(e){var t=c[d]?"":e;return d++,t})}r.getSanitizingConverter=function(t){return t=t||new r.Converter,t.hooks.chain("postConversion",e),t.hooks.chain("postConversion",n),t};var i=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,o=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,a=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}(),function(){function e(){}function t(e){this.buttonBar=p.getElementById("wmd-button-bar"+e),this.preview=p.getElementById("wmd-preview"+e),this.input=p.getElementById("wmd-input"+e)}function n(e,t){var n,r,o,a=this,s=[],l=0,u="none",d=function(e,t){u!=e&&(u=e,t||f()),m&&"moving"==u?o=null:r=setTimeout(p,1)},p=function(e){o=new i(t,e),r=void 0};this.setCommandMode=function(){u="command",f(),r=setTimeout(p,0)},this.canUndo=function(){return l>1},this.canRedo=function(){return s[l+1]?!0:!1},this.undo=function(){a.canUndo()&&(n?(n.restore(),n=null):(s[l]=new i(t),s[--l].restore(),e&&e())),u="none",t.input.focus(),p()},this.redo=function(){a.canRedo()&&(s[++l].restore(),e&&e()),u="none",t.input.focus(),p()};var f=function(){var r=o||new i(t);return r?"moving"==u?(n||(n=r),void 0):(n&&(s[l-1].text!=n.text&&(s[l++]=n),n=null),s[l++]=r,s[l+1]=null,e&&e(),void 0):!1},h=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode,r=String.fromCharCode(n);switch(r.toLowerCase()){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}return t?(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1),void 0):void 0},g=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&40>=t||t>=63232&&63235>=t?d("moving"):8==t||46==t||127==t?d("deleting"):13==t?d("newlines"):27==t?d("escape"):(16>t||t>20)&&91!=t&&d("typing")}},v=function(){c.addEvent(t.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(m||o&&o.text!=t.input.value)&&void 0==r&&(u="paste",f(),p())};c.addEvent(t.input,"keydown",h),c.addEvent(t.input,"keydown",g),c.addEvent(t.input,"mousedown",function(){d("moving")}),t.input.onpaste=e,t.input.ondrop=e},b=function(){v(),p(!0),f()};b()}function i(t,n){var r=this,i=t.input;this.init=function(){c.isVisible(i)&&(n||!p.activeElement||p.activeElement===i)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=i.scrollTop,(!this.text&&i.selectionStart||0===i.selectionStart)&&(this.text=i.value))},this.setInputAreaSelection=function(){if(c.isVisible(i))if(void 0!==i.selectionStart)i.focus(),i.selectionStart=r.start,i.selectionEnd=r.end,i.scrollTop=r.scrollTop;else if(p.selection){if(p.activeElement&&p.activeElement!==i)return;i.focus();var e=i.createTextRange();e.moveStart("character",-i.value.length),e.moveEnd("character",-i.value.length),e.moveEnd("character",r.end),e.moveStart("character",r.start),e.select()}},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!i.selectionStart&&0!==i.selectionStart){if(p.selection){r.text=c.fixEolChars(i.value);var e=t.ieCachedRange||p.selection.createRange(),n=c.fixEolChars(e.text),o="",a=o+n+o;e.text=a;var s=c.fixEolChars(i.value);e.moveStart("character",-a.length),e.text=n,r.start=s.indexOf(o),r.end=s.lastIndexOf(o)-o.length;var l=r.text.length-c.fixEolChars(i.value).length;if(l){for(e.moveStart("character",-n.length);l--;)n+="\n",r.end+=1;e.text=n}t.ieCachedRange&&(r.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else r.start=i.selectionStart,r.end=i.selectionEnd},this.restore=function(){void 0!=r.text&&r.text!=i.value&&(i.value=r.text),this.setInputAreaSelection(),i.scrollTop=r.scrollTop},this.getChunks=function(){var t=new e;return t.before=c.fixEolChars(r.text.substring(0,r.start)),t.startTag="",t.selection=c.fixEolChars(r.text.substring(r.start,r.end)),t.endTag="",t.after=c.fixEolChars(r.text.substring(r.end)),t.scrollTop=r.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function o(e,t,n){var r,i,o,a=3e3,s="delayed",l=function(e,t){c.addEvent(e,"input",t),e.onpaste=t,e.ondrop=t,c.addEvent(e,"keypress",t),c.addEvent(e,"keydown",t)},d=function(){var e=0;return window.innerHeight?e=window.pageYOffset:p.documentElement&&p.documentElement.scrollTop?e=p.documentElement.scrollTop:p.body&&(e=p.body.scrollTop),e},f=function(){if(t.preview){var n=t.input.value;if(!n||n!=o){o=n;var r=(new Date).getTime();n=e.makeHtml(n);var a=(new Date).getTime();i=a-r,T(n)}}},h=function(){if(r&&(clearTimeout(r),r=void 0),"manual"!==s){var e=0;"delayed"===s&&(e=i),e>a&&(e=a),r=setTimeout(f,e)}},g=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)},v=function(){t.preview&&(t.preview.scrollTop=(t.preview.scrollHeight-t.preview.clientHeight)*g(t.preview))};this.refresh=function(e){e?(o="",f()):h()},this.processingTime=function(){return i};var b,y=!0,w=function(e){var n=t.preview,r=n.parentNode,i=n.nextSibling;r.removeChild(n),n.innerHTML=e,i?r.insertBefore(n,i):r.appendChild(n)},x=function(e){t.preview.innerHTML=e},k=function(e){if(b)return b(e);try{x(e),b=x}catch(t){b=w,b(e)}},T=function(e){var r=u.getTop(t.input)-d();if(t.preview&&(k(e),n()),v(),y)return y=!1,void 0;var i=u.getTop(t.input)-d();m?setTimeout(function(){window.scrollBy(0,i-r)},0):window.scrollBy(0,i-r)},$=function(){l(t.input,h),f(),t.preview&&(t.preview.scrollTop=0)};$()}function a(e,t,n,r,o,a,s){function l(e){if(v.focus(),e.textOp){n&&n.setCommandMode();var o=new i(t);if(!o)return;var a=o.getChunks(),s=function(){v.focus(),a&&o.setChunks(a),o.restore(),r.refresh()},l=e.textOp(a,s);l||s()}e.execute&&e.execute(n)}function u(e,n){var r="0px",i="-20px",o="-40px",a=e.getElementsByTagName("span")[0];n?(a.style.backgroundPosition=e.XShift+" "+r,e.onmouseover=function(){a.style.backgroundPosition=this.XShift+" "+o},e.onmouseout=function(){a.style.backgroundPosition=this.XShift+" "+r},m&&(e.onmousedown=function(){p.activeElement&&p.activeElement!==t.input||(t.ieCachedRange=document.selection.createRange(),t.ieCachedScrollTop=t.input.scrollTop)}),e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),l(this),!1})):(a.style.backgroundPosition=e.XShift+" "+i,e.onmouseover=e.onmouseout=e.onclick=function(){})}function d(e){return"string"==typeof e&&(e=o[e]),function(){e.apply(o,arguments)}}function f(){var n=t.buttonBar,r=document.createElement("ul");r.id="wmd-button-row"+e,r.className="wmd-button-row",r=n.appendChild(r);var i=0,o=function(t,n,o,a){var s=document.createElement("li");s.className="wmd-button",s.style.left=i+"px",i+=25;var l=document.createElement("span");return s.id=t+e,s.appendChild(l),s.title=n,s.XShift=o,a&&(s.textOp=a),u(s,!0),r.appendChild(s),s},l=function(t){var n=document.createElement("li");n.className="wmd-spacer wmd-spacer"+t,n.id="wmd-spacer"+t+e,r.appendChild(n),i+=25};b.bold=o("wmd-bold-button",s("bold"),"0px",d("doBold")),b.italic=o("wmd-italic-button",s("italic"),"-20px",d("doItalic")),l(1),b.link=o("wmd-link-button",s("link"),"-40px",d(function(e,t){return this.doLinkOrImage(e,t,!1)})),b.quote=o("wmd-quote-button",s("quote"),"-60px",d("doBlockquote")),b.code=o("wmd-code-button",s("code"),"-80px",d("doCode")),b.image=o("wmd-image-button",s("image"),"-100px",d(function(e,t){return this.doLinkOrImage(e,t,!0)})),l(2),b.olist=o("wmd-olist-button",s("olist"),"-120px",d(function(e,t){this.doList(e,t,!0)})),b.ulist=o("wmd-ulist-button",s("ulist"),"-140px",d(function(e,t){this.doList(e,t,!1)})),b.heading=o("wmd-heading-button",s("heading"),"-160px",d("doHeading")),b.hr=o("wmd-hr-button",s("hr"),"-180px",d("doHorizontalRule")),l(3),b.undo=o("wmd-undo-button",s("undo"),"-200px",null),b.undo.execute=function(e){e&&e.undo()};var c=/win/.test(h.platform.toLowerCase())?s("redo"):s("redomac");if(b.redo=o("wmd-redo-button",c,"-220px",null),b.redo.execute=function(e){e&&e.redo()},a){var p=document.createElement("li"),f=document.createElement("span");p.appendChild(f),p.className="wmd-button wmd-help-button",p.id="wmd-help-button"+e,p.XShift="-240px",p.isHelp=!0,p.style.right="0px",p.title=s("help"),p.onclick=a.handler,u(p,!0),r.appendChild(p),b.help=p}g()}function g(){n&&(u(b.undo,n.canUndo()),u(b.redo,n.canRedo()))}var v=t.input,b={};f(),c.addEvent(v,"keydown",function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode,n=String.fromCharCode(t).toLowerCase();switch(n){case"b":l(b.bold);break;case"i":l(b.italic);break;case"l":l(b.link);break;case"q":l(b.quote);break;case"k":l(b.code);break;case"g":l(b.image);break;case"o":l(b.olist);break;case"u":l(b.ulist);break;case"h":l(b.heading);break;case"r":l(b.hr);break;case"y":l(b.redo);break;case"z":e.shiftKey?l(b.redo):l(b.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),c.addEvent(v,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;if(13===t){var n={};n.textOp=d("doAutoindent"),l(n)}}}),m&&c.addEvent(v,"keydown",function(e){var t=e.keyCode;return 27===t?!1:void 0}),this.setUndoRedoButtonStates=g}function s(e,t){this.hooks=e,this.getString=t}function l(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){return t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")}),t=decodeURIComponent(t),t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"),t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")}),n&&(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,""),n=n.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t})}var c={},u={},d={},p=window.document,f=window.RegExp,h=window.navigator,g={lineLength:72},m=/msie/.test(h.userAgent.toLowerCase()),v={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"},b="http://",y="http://";r.Editor=function(e,i,l){l=l||{},l.strings=l.strings||{},l.helpButton&&(l.strings.help=l.strings.help||l.helpButton.title);var c=function(e){return l.strings[e]||v[e]};i=i||"";var u=this.hooks=new r.HookCollection;u.addNoop("onPreviewRefresh"),u.addNoop("postBlockquoteCreation"),u.addFalse("insertImageDialog"),this.getConverter=function(){return e};var d,f=this;this.run=function(){if(!d){d=new t(i);var r,h,g=new s(u,c),m=new o(e,d,function(){u.onPreviewRefresh()});/\?noundo/.test(p.location.href)||(r=new n(function(){m.refresh(),h&&h.setUndoRedoButtonStates()},d),this.textOperation=function(e){r.setCommandMode(),e(),f.refreshPreview()}),h=new a(i,d,r,m,g,l.helpButton,c),h.setUndoRedoButtonStates();var v=f.refreshPreview=function(){m.refresh(!0)};v()}}},e.prototype.findTags=function(e,t){var n,r=this;e&&(n=c.extendRegExp(e,"","$"),this.before=this.before.replace(n,function(e){return r.startTag=r.startTag+e,""}),n=c.extendRegExp(e,"^",""),this.selection=this.selection.replace(n,function(e){return r.startTag=r.startTag+e,""})),t&&(n=c.extendRegExp(t,"","$"),this.selection=this.selection.replace(n,function(e){return r.endTag=e+r.endTag,""}),n=c.extendRegExp(t,"^",""),this.after=this.after.replace(n,function(e){return r.endTag=e+r.endTag,""}))},e.prototype.trimWhitespace=function(e){var t,n,r=this;e?t=n="":(t=function(e){return r.before+=e,""},n=function(e){return r.after=e+r.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},e.prototype.skipLines=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),e++,t++;var r,i;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+f.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+f.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+f.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+f.$1,this.before){for(r=i="";e--;)r+="\\n?",i+="\n";n&&(r="\\n*"),this.before=this.before.replace(new f(r+"$",""),i)}if(this.after){for(r=i="";t--;)r+="\\n?",i+="\n";n&&(r="\\n*"),this.after=this.after.replace(new f(r,""),i)}},c.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},c.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},c.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},c.fixEolChars=function(e){return e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n")},c.extendRegExp=function(e,t,n){(null===t||void 0===t)&&(t=""),(null===n||void 0===n)&&(n="");var r,i=""+e;return i=i.replace(/\/([gim]*)$/,function(e,t){return r=t,""}),i=i.replace(/(^\/|\/$)/g,""),i=t+i+n,new f(i,r)},u.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},u.getHeight=function(e){return e.offsetHeight||e.scrollHeight},u.getWidth=function(e){return e.offsetWidth||e.scrollWidth},u.getPageSize=function(){var e,t,n,r;self.innerHeight&&self.scrollMaxY?(e=p.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):p.body.scrollHeight>p.body.offsetHeight?(e=p.body.scrollWidth,t=p.body.scrollHeight):(e=p.body.offsetWidth,t=p.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):p.documentElement&&p.documentElement.clientHeight?(n=p.documentElement.clientWidth,r=p.documentElement.clientHeight):p.body&&(n=p.body.clientWidth,r=p.body.clientHeight);var i=Math.max(e,n),o=Math.max(t,r);return[i,o,n,r]},d.createBackground=function(){var e=p.createElement("div"),t=e.style;e.className="wmd-prompt-background",t.position="absolute",t.top="0",t.zIndex="1000",m?t.filter="alpha(opacity=50)":t.opacity="0.5";var n=u.getPageSize();return t.height=n[1]+"px",m?(t.left=p.documentElement.scrollLeft,t.width=p.documentElement.clientWidth):(t.left="0",t.width="100%"),p.body.appendChild(e),e},d.prompt=function(e,t,n){var r,i;void 0===t&&(t="");var o=function(e){var t=e.charCode||e.keyCode;27===t&&a(!0)},a=function(e){c.removeEvent(p.body,"keydown",o);var t=i.value;return e?t=null:(t=t.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(t)||(t="http://"+t)),r.parentNode.removeChild(r),n(t),!1},s=function(){r=p.createElement("div"),r.className="wmd-prompt-dialog",r.style.padding="10px;",r.style.position="fixed",r.style.width="400px",r.style.zIndex="1001";var n=p.createElement("div");n.innerHTML=e,n.style.padding="5px",r.appendChild(n);var s=p.createElement("form"),l=s.style;s.onsubmit=function(){return a(!1)},l.padding="0",l.margin="0",l.cssFloat="left",l.width="100%",l.textAlign="center",l.position="relative",r.appendChild(s),i=p.createElement("input"),i.type="text",i.value=t,l=i.style,l.display="block",l.width="80%",l.marginLeft=l.marginRight="auto",s.appendChild(i);var d=p.createElement("input");d.type="button",d.onclick=function(){return a(!1)},d.value="OK",l=d.style,l.margin="10px",l.display="inline",l.width="7em";var f=p.createElement("input");f.type="button",f.onclick=function(){return a(!0)},f.value="Cancel",l=f.style,l.margin="10px",l.display="inline",l.width="7em",s.appendChild(d),s.appendChild(f),c.addEvent(p.body,"keydown",o),r.style.top="50%",r.style.left="50%",r.style.display="block",p.body.appendChild(r),r.style.marginTop=-(u.getHeight(r)/2)+"px",r.style.marginLeft=-(u.getWidth(r)/2)+"px"};setTimeout(function(){s();var e=t.length;if(void 0!==i.selectionStart)i.selectionStart=0,i.selectionEnd=e;else if(i.createTextRange){var n=i.createTextRange();n.collapse(!1),n.moveStart("character",-e),n.moveEnd("character",e),n.select()}i.focus()},0)};var w=s.prototype;w.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",w.unwrap=function(e){var t=new f("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},w.wrap=function(e,t){this.unwrap(e);var n=new f("(.{1,"+t+"})( +|$\\n?)","gm"),r=this;e.selection=e.selection.replace(n,function(e,t){return new f("^"+r.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},w.doBold=function(e,t){return this.doBorI(e,t,2,this.getString("boldexample"))},w.doItalic=function(e,t){return this.doBorI(e,t,1,this.getString("italicexample"))},w.doBorI=function(e,t,n,r){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var i=/(\**$)/.exec(e.before)[0],o=/(^\**)/.exec(e.after)[0],a=Math.min(i.length,o.length);if(a>=n&&(2!=a||1!=n))e.before=e.before.replace(f("[*]{"+n+"}$",""),""),e.after=e.after.replace(f("^[*]{"+n+"}",""),"");else if(!e.selection&&o){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var s=f.$1;e.before=e.before+o+s}else{e.selection||o||(e.selection=r);var l=1>=n?"*":"**";e.before=e.before+l,e.after=l+e.after}},w.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,r,i,o){return t[n]=e.replace(/\s*$/,""),i?(t[n]=e.replace(/["(](.+?)[")]$/,""),i+o):""})},w.addLinkDef=function(e,t){var n=0,r={};e.before=this.stripLinkDefs(e.before,r),e.selection=this.stripLinkDefs(e.selection,r),e.after=this.stripLinkDefs(e.after,r);var i="",o=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,a=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),i+="\n"+e},s=function(e,t,i,l,c,u){return i=i.replace(o,s),r[c]?(a(r[c]),t+i+l+n+u):e};e.before=e.before.replace(o,s),t?a(t):e.selection=e.selection.replace(o,s);var l=n;return e.after=e.after.replace(o,s),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+i,l},w.doLinkOrImage=function(e,t,n){e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var r;if(!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return this.addLinkDef(e,null),void 0;var i=this,o=function(o){if(r.parentNode.removeChild(r),null!==o){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var a=" [999]: "+l(o),s=i.addLinkDef(e,a);e.startTag=n?"![":"[",e.endTag="]["+s+"]",e.selection||(e.selection=n?i.getString("imagedescription"):i.getString("linkdescription"))}t()};return r=d.createBackground(),n?this.hooks.insertImageDialog(o)||d.prompt(this.getString("imagedialog"),b,o):d.prompt(this.getString("linkdialog"),y,o),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},w.doAutoindent=function(e){var t=this,n=!1;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),e.selection||/^[ \t]*(?:\n|$)/.test(e.after)||(e.after=e.after.replace(/^[^\n]*/,function(t){return e.selection=t,""}),n=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&t.doList&&t.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&t.doBlockquote&&t.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&t.doCode&&t.doCode(e),n&&(e.after=e.selection+e.after,e.selection="")},w.doBlockquote=function(e){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,r,i){return e.before+=n,e.after=i+e.after,r}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""}),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||this.getString("quoteexample");var t,n="",r="";if(e.before){for(var i=e.before.replace(/\n$/,"").split("\n"),o=!1,a=0;i.length>a;a++){var s=!1;t=i[a],o=o&&t.length>0,/^>/.test(t)?(s=!0,!o&&t.length>1&&(o=!0)):s=/^[ \t]*$/.test(t)?!0:o,s?n+=t+"\n":(r+=n+t,n="\n")}/(^|\n)>/.test(n)||(r+=n,n="")}e.startTag=n,e.before=r,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var l=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,g.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),l(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),l(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},w.doCode=function(e){var t=/\S[ ]*$/.test(e.before),n=/^[ ]*\S/.test(e.after);if(!n&&!t||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var r=1,i=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&(r=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(i=0),e.skipLines(r,i),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?/\n/.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection=this.getString("codeexample"))}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=this.getString("codeexample")))},w.doList=function(e,t,n){function r(){var e;return n?(e=" "+l+". ",l++):e=" "+s+" ",e}function i(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,r)}var o=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,a=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,s="-",l=1;if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var c=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),c&&(e.after=e.after.replace(a,i)),n==c)return}var u=1;e.before=e.before.replace(o,function(e){return/^\s*([*+-])/.test(e)&&(s=f.$1),u=/[^\n]\n\n[^\n]/.test(e)?1:0,i(e)}),e.selection||(e.selection=this.getString("litem"));var d=r(),p=1;e.after=e.after.replace(a,function(e){return p=/[^\n]\n\n[^\n]/.test(e)?1:0,i(e)}),e.trimWhitespace(!0),e.skipLines(u,p,!0),e.startTag=d;var h=d.replace(/./g," ");this.wrap(e,g.lineLength-h.length),e.selection=e.selection.replace(/\n/g,"\n"+h)},w.doHeading=function(e){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection=this.getString("headingexample"),e.endTag=" ##",void 0;var t=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(t=f.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(t=1),/-+/.test(e.endTag)&&(t=2),e.startTag=e.endTag="",e.skipLines(1,1);var n=0==t?2:t-1;if(n>0){var r=n>=2?"-":"=",i=e.selection.length;for(i>g.lineLength&&(i=g.lineLength),e.endTag="\n";i--;)e.endTag+=r}},w.doHorizontalRule=function(e){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}(),n.exports=r}),require.register("rooms/libraries/path.js",function(e,t,n){function r(e){this.path=e,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},l[e]=this}var i,o,a,s,l={},c={map:function(e){return l.hasOwnProperty(e)?l[e]:new r(e)},root:function(e){o=e},rescue:function(e){a=e},match:function(e,t){var n,r,i,o,a,s={},c=null;for(c in l)if(null!==c&&void 0!==c)for(c=l[c],n=c.partition(),o=0;n.length>o;o++){if(r=n[o],a=e,r.search(/:/)>0)for(i=0;r.split("/").length>i;i++)a.split("/").length>i&&":"===r.split("/")[i].charAt(0)&&(s[r.split("/")[i].replace(/:/,"")]=a.split("/")[i],a=a.replace(a.split("/")[i],r.split("/")[i]));if(r===a)return t&&(c.params=s),c}return null},dispatch:function(e){var t,n;if(i!==e){if(s=i,i=e,n=c.match(e,!0),s&&(t=c.match(s),null!==t&&null!==t.do_exit&&t.do_exit()),null!==n)return n.run(),!0;null!==a&&a()}},listen:function(){var e=function(){c.dispatch(location.hash)};""===location.hash&&null!==o&&(location.hash=o),window.onhashchange=e,""!==location.hash&&c.dispatch(location.hash)}};r.prototype={to:function(e){return this.action=e,this},enter:function(e){return e instanceof Array?this.do_enter=this.do_enter.concat(e):this.do_enter.push(e),this},exit:function(e){return this.do_exit=e,this},partition:function(){for(var e,t,n=[],r=[],i=/\(([^}]+?)\)/g;e=i.exec(this.path);)n.push(e[1]);for(r.push(this.path.split("(")[0]),t=0;n.length>t;t++)r.push(r[r.length-1]+n[t]);return r},run:function(){var e,t,n=!1;if(l[this.path].hasOwnProperty("do_enter")&&l[this.path].do_enter.length>0)for(e=0;l[this.path].do_enter.length>e;e++)if(t=l[this.path].do_enter[e].apply(this,null),t===!1){n=!0;break}n||l[this.path].action()}},n.exports=c}),require.register("rooms/template.js",function(e,t,n){function r(e,t){return 2===arguments.length?Mustache.to_html(i[e],t):1===arguments.length?function(t){return Mustache.to_html(i[e],t)}:void 0}var i={allocationEdit:'<h1>Edit allocations for accademic year beginning {{year}}</h1><hr /><div> {{#staircases}} <div class="allocationBlock"><h2>{{{name}}}</h2> {{#rooms}} <form data-old-allocation="{{allocation}}" data-roomid="{{id}}"> {{name}}: <input name="allocation" type="text" value="{{allocation}}" /></form> {{/rooms}} </div> {{/staircases}}</div>',choosingOrderEdit:'<div id="tabs"><ul><li><a href="#tabs-1">First Years</a></li><li><a href="#tabs-2">Second Years</a></li><li><a href="#tabs-3">Third Years</a></li></ul><div id="tabs-1"><ul id="sortable" class="sortable"><li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Joe Blogs <button> Delete</button></li><li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>John Smith </li></ul></div><div id="tabs-2"> Second Years </div><div id="tabs-3"> Third Years </div></div>',markdownEdit:'<form><div class="wmd-panel"><div id="wmd-button-bar"></div><textarea class="wmd-input" id="wmd-input" name="content">{{{Content}}}</textarea></div><div id="wmd-preview" class="wmd-panel wmd-preview"></div><input type="submit" value="Save" /></form><div id="getImage" class="dialog" title="Insert Image"><label> Select an image to upload</label><br /><input type="file" required /></div><div id="busy" class="dialog" title="Uploading"><div class="ajaxLoader"></div></div><div id="getURL" class="dialog" title="Insert Hyperlink"><form><label> http://example.com/ "optional title"</label><br /><input name="fileUpload" type="url" value="http://" /><br /></form></div>',NavigationList:'{{#Links}} <a href="{{url}}" {{#selected}}class="Selected"{{/selected}}>{{{name}}}</a>{{/Links}}',navigationTableEdit:'<h2> Add New</h2><form><label>ID</label><input name="id" type="text" /><label>Name</label><input name="name" type="text" required /><br /><label>Parent ID</label><input name="parentid" type="text" value="{{parentid}}" /><label>Type</label><select name="type"><option>staircase</option><option selected>room</option><option>page</option><option>special</option></select><br /><label>Weight</label><input name="weight" type="number" /><label>Bathroom Sharing</label><input name="bathroomsharing" type="number" value="{{bathroomsharing}}" /><br /><label>Rent Band</label><input name="rentband" type="number" value="{{rentband}}" /><label>Floor</label><input name="floor" type="number" value="{{floor}}" /><br /><input type="submit" value="Save" /></form><h2> Edit Existing</h2><table><tr><th> ID </th><th> Name </th><th> Parent ID </th><th> Type </th><th> Weight </th><th> Bathroom Sharing </th><th> Rent Band </th><th> Floor </th><th></th></tr> {{#Navigation}} <tr itemid="{{id}}"><td itemprop="id" data-type="text"><!--Required but could be ""--><div>{{id}}</div><input style="display: none; width:110px" type="text" value="{{id}}" /></td><td itemprop="name" data-type="text"><div>{{{name}}}</div><input style="display: none; width:115px" type="text" required value="{{name}}" /></td><td itemprop="parentid" data-type="text"><!--Required but could be ""--><div>{{parentid}}</div><input style="display: none; width:40px" type="text" value="{{parentid}}" /></td><td itemprop="type" data-type="text" style="width: 84px"><div>{{type}}</div><select style="display: none;" required ><option {{#isStaircase}}selected{{/isStaircase}}>staircase</option><option {{#isRoom}}selected{{/isRoom}}>room</option><option {{#isPage}}selected{{/isPage}}>page</option><option {{#isSpecial}}selected{{/isSpecial}}>special</option></select></td><td itemprop="weight" data-type="text"><div>{{weight}}</div><input style="display: none; width: 45px" type="number" value="{{weight}}" /></td><td itemprop="bathroomsharing" data-type="text"><div>{{bathroomsharing}}</div><input style="display: none; width:30px" type="number" value="{{bathroomsharing}}" /></td><td itemprop="rentband" data-type="text"><div>{{rentband}}</div><input style="display: none; width:30px" type="number" value="{{rentband}}" /></td><td itemprop="floor" data-type="text"><div>{{floor}}</div><input style="display: none; width:30px" type="number" value="{{floor}}" /></td><td><button>Delete</button></td></tr> {{/Navigation}}</table>',projector:'{{#staircases}}<div class="projectorBlock"><h1><a href="{{url}}">{{{name}}}</a></h1><ul> {{#rooms}} <li id="{{id}}" class="{{css}}"><a href="{{url}}">{{{name}}}<span class="allocationDisplayPart"> - <span class="allocationDisplay" data-roomid="{{id}}"></span></span></a></li> {{/rooms}} </ul></div>{{/staircases}}',room:'{{#rentband}}<table class="horizontalTable"><tr><th> Bathroom </th><td> {{bathroom}} </td></tr><tr><th> Rent Band </th><td> {{rentBandDescription}} </td></tr><tr><th> Floor </th><td> {{floorDescription}} </td></tr><tr><th> Current Allocation </th><td><span class="allocationDisplay" data-roomid="{{id}}" data-year="current"></span></td></tr><tr><th> Next Year\'s Allocation </th><td><span class="allocationDisplay" data-roomid="{{id}}" data-year="next"></span></td></tr></table>{{/rentband}}',staircase:'{{#Floors}}<h2> {{Name}}</h2><ul> {{#Rooms}} <li><a href="{{url}}">{{nameSingleLine}}{{#rentband}} - {{#bathroom}}{{bathroom}}, {{/bathroom}}{{rentBandDescription}}, <span class="allocationDisplay" data-roomid="{{id}}"></span>{{/rentband}}</a></li> {{/Rooms}}</ul>{{/Floors}}'};
r.templates=i,n.exports=r}),require.register("rooms/server.js",function(e,t,n){function r(e,t){var n=Object.create(e);return n.method="PUT",void 0!==t&&(n.isNew=t),n}function i(e){var t=Object.create(e);return t.method="DELETE",t}var o="/",a={};n.exports={prefix:o,markdown:{read:function(e,t){var n=e.id;a[n]?setTimeout(function(){t(a[n])},0):$.get(o+"data/markdown/"+n,function(r){function i(e){a[n]=e,t(e)}if(r)i(r);else{var o="===============================================";i(e.name+"\n"+(e.name&&o.substr(0,e.name.length)||o.substr(0,n.length))+"\n\nThere is no description for this "+e.type+", why not consider adding one?")}})},update:function(e,t,n){a[e]=t,$.post(o+"data/markdown/"+e,{content:t},n)}},navigation:{create:function(e,t){$.post(o+"data/navigation",r(e,!0),t)},read:function(e){$.getJSON(o+"data/navigation",e)},update:function(e,t,n,i){$.post(o+"data/navigation",r({id:e,name:t,value:n},!1),i)},del:function(e,t){$.post(o+"data/navigation",i({id:e}),t)}},allocation:{update:function(e,t,n,i){$.post(o+"data/allocations",r({roomid:e,year:t,crsid:n}),i)}}}}),require.register("rooms/stream.js",function(e,t,n){var r=t("./server"),i=t("emitter");n.exports=function(){function e(e,t){return Object.create({year:function(){var e=new Date;return(e.getMonth()>6?e.getFullYear():e.getFullYear()-1)+t}(),defaultText:e})}function t(e){for(var t=0;e.allocations.length>t;t++){var n=e.allocations[t];n.year=parseInt(n.year,10);var r=n.roomid,i=n.crsid,o=n.year,a={};o===s.allocationsThisYear.year?a=s.allocationsThisYear:o===s.allocationsNextYear.year&&(a=s.allocationsNextYear),a[r]=i}return s}function n(){var e=[];for(var t in s.defaultAllocations())s.defaultAllocations().hasOwnProperty(t)&&e.push({roomid:t,crsid:s.defaultAllocations()[t],year:s.defaultAllocations().year});return{allocations:e}}var o=new i;(function(){function e(e){o.emit("raw",e)}var t=!1,n=function(e){t=e},i=function(){return!1};$(function(){function r(){if("undefined"!=typeof io){var r,o=io.connect(r),a=o.socket,s=!1;n=function(n){t=n||t,t&&a.connected&&o.emit("auth",t,function(t){e(t),s=!0})},o.on("authRequired",function(){n()}),o.on("message",function(t){e(t)});var l=0;setInterval(function(){i()?(e({}),l=0):(l++,l>600+Math.floor(60*Math.random())&&(l=0,location.reload(!1)))},1e3),a.on("reconnect_failed",function(){setTimeout(function(){window.location.reload(!1)},500)}),i=function(){return a.connected&&s}}}var o=document.createElement("script");o.type="text/javascript",o.src="/socket.io/socket.io.js",o.async=!1,o.onreadystatechange=o.onload=function(){var e=o.readyState;r.done||e&&!/loaded|complete/.test(e)||(r.done=!0,r())},document.body.appendChild(o)}),function(){function t(){function o(r,o){var a=new Date;r.auth&&r.auth.notificationKey&&n(r.auth.notificationKey),e(r),setTimeout(t,(i()?24e4:o)+10*(a.getTime()-s.getTime()))}var s=new Date;$.ajax({url:r.prefix+"data/stream",dataType:"json",data:a,success:function(e){o(e,3e4)},error:function(e,t){o(t,12e4)}})}t()}()})();var a={},s={allocationsThisYear:e("Unknown",0),allocationsNextYear:e("Available",1),defaultAllocations:function(){return 0===$("#isThisYears:checked").length?this.allocationsNextYear:this.allocationsThisYear},loaded:!1};return o.on("raw",function(e){if(e.auth&&(a.auth=e.auth.isAuthenticated,o.emit("auth",e.auth)),e.allocations){s.loaded=!0,o.emit("allocations",t(e));for(var n=0;e.allocations.length>n;n++)o.emit("allocation",e.allocations[n]),s.defaultAllocations().year===parseInt(e.allocations[n].year,10)&&o.emit("default-year-allocation",e.allocations[n])}}),o.onAllocationChanged=function(e){for(var t=n().allocations,r=0;t.length>r;r++)e(t[r]);return o.on("default-year-allocation",e),function(){o.off("default-year-allocation",e)}},o.getAllocations=function(e){s.loaded?e(s):o.once("allocations",e)},o}()}),require.alias("ForbesLindesay-curry/index.js","rooms/deps/curry/index.js"),require.alias("ForbesLindesay-queue/index.js","rooms/deps/queue/index.js"),require.alias("ForbesLindesay-to-bool-function/index.js","rooms/deps/to-bool-function/index.js"),require.alias("component-to-function/index.js","ForbesLindesay-to-bool-function/deps/to-function/index.js"),require.alias("component-type/index.js","ForbesLindesay-to-bool-function/deps/type/index.js"),require.alias("ForbesLindesay-base64-encode/index.js","rooms/deps/base64-encode/index.js"),require.alias("ForbesLindesay-utf8-encode/index.js","ForbesLindesay-base64-encode/deps/utf8-encode/index.js"),require.alias("ForbesLindesay-imgur/index.js","rooms/deps/imgur/index.js"),require.alias("ForbesLindesay-promises-a/index.js","ForbesLindesay-imgur/deps/promises-a/index.js"),require.alias("component-emitter/index.js","ForbesLindesay-imgur/deps/emitter/index.js"),require.alias("component-find/index.js","rooms/deps/find/index.js"),require.alias("component-to-function/index.js","component-find/deps/to-function/index.js"),require.alias("component-group-by/index.js","rooms/deps/group-by/index.js"),require.alias("component-to-function/index.js","component-group-by/deps/to-function/index.js"),require.alias("component-emitter/index.js","rooms/deps/emitter/index.js");